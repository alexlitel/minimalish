$(document).ready(function(){(function mobileToggle(){$('#menu-toggle').on('click touchstart',function(event){event.preventDefault();if(!($(this).hasClass('is-rotated'))){$(this).addClass('is-rotated');$('.header-box-link-list').removeClass('mobile-toggle-hide');$(this).attr({"title":"Click, tap, or press 'Enter' to hide menu.","aria-expanded":"true"});}else{$('.header-box-link-list').addClass('mobile-toggle-hide');$(this).removeClass('is-rotated');$(this).attr({'title':"Click, tap, or press 'Enter' to show menu.","aria-expanded":"false"});}});$('#search-toggle').on('click touchstart',function(event){event.preventDefault();if(!($(this).hasClass('tumblr-icon-cancel'))){$(this).addClass('tumblr-icon-cancel');$('.header-box-form').removeClass('mobile-toggle-hide');$(this).attr({'title':"Click, tap, or press 'Enter' to hide search.",'aria-expanded':"true"});}else{$('.header-box-form').addClass('mobile-toggle-hide');$(this).removeClass('tumblr-icon-cancel').addClass('tumblr-icon-search');$(this).attr({'title':"Click, tap, or press 'Enter' to show search.",'aria-expanded':"false"});}}); $('.header-box-link-list-item:last-child').on('keydown',function(event){if($('#menu-toggle').css('display')==="block"){var code=event.which||event.keycode; if(code===9&&!event.shiftKey){event.preventDefault();$('#menu-toggle').focus();}}}); $('.header-box-submit').on('keydown',function(event){if($('#search-toggle').css('display')==="block"){var code=event.which||event.keycode; if(code===9&&!event.shiftKey){event.preventDefault();$('#search-toggle').focus();}}});}()); /** * photoset-grid - v1.0.1 *2014-04-08* jQuery plugin to arrange images into a flexible grid * http://stylehatch.github.com/photoset-grid/ * * Copyright 2014 Jonathan Moore - Style Hatch*/;(function($,window,document,undefined){'use strict'; var pluginName="photosetGrid",defaults={ gutter:'10px',highresLinks:false, lowresWidth:500, rel:'', onInit:function(){},onComplete:function(){}}; function Plugin(element,options){this.element=element;this.options=$.extend({},defaults,options);this._defaults=defaults;this._name=pluginName;this.init();}Plugin.prototype={init:function(){ this.options.onInit();this._setupRows(this.element,this.options);this._setupColumns(this.element,this.options);},_callback:function(elem){ this.options.onComplete(elem);},_setupRows:function(elem,options){ if(options.layout){ this.layout=options.layout;}else if($(elem).attr('data-layout')){ this.layout=$(elem).attr('data-layout');}else{var stackedLayout="";var defaultColumns=1;for(var a=0;a<$(elem).find('.photoset-post-photoset-cell').length;a++){stackedLayout=stackedLayout+defaultColumns.toString();}this.layout=stackedLayout;}this.rows=this.layout.split('');for(var i in this.rows){this.rows[i]=parseInt(this.rows[i],10);}var $images=$(elem).find('img');var $links=$(elem).find('.photoset-post-photoset-cell');var imageIndex=0;$.each(this.rows,function(i,val){var rowStart=imageIndex;var rowEnd=imageIndex+val;var wrapper=document.createElement('div'); $links.slice(rowStart,rowEnd).wrapAll('<div class="photoset-post-photoset-row photoset-post-photoset-row-cols-'+val+'"></div>');imageIndex=rowEnd;});},_setupColumns:function(elem,options){ var $this=this;var setupStyles=function(waitForImagesLoaded){var $rows=$(elem).find('.photoset-post-photoset-row');var $links=$(elem).find('.photoset-post-photoset-cell');var $images=$(elem).find('img');if(options.highresLinks){$images.each(function(){var title; if($(this).attr('title')){title=' title="'+$(this).attr('title')+'"';}else{title='';}var highres;if($(this).attr('data-highres')){highres=$(this).attr('data-highres');}else{highres=$(this).attr('src');}}); if(options.rel){$images.parent().attr('rel',options.rel);}}if(waitForImagesLoaded){$images.each(function(){$(this).attr('height',$(this).height());$(this).attr('width',$(this).width());});}var gutterVal=parseInt(options.gutter,10);function resizePhotosetGrid(){ var w=$(elem).width().toString();if(w!==$(elem).attr('data-width')){$rows.each(function(){var $shortestImg=$(this).find('img:eq(0)');$(this).find('img').each(function(){var $img=$(this);if($img.attr('height')<$shortestImg.attr('height')){$shortestImg=$(this);}if(parseInt($img.css('width'),10)>options.lowresWidth&&$img.attr('data-highres')){$img.attr('src',$img.attr('data-highres'));}}); var rowHeight=($shortestImg.attr('height')*parseInt($shortestImg.css('width'),10))/$shortestImg.attr('width'); var bufferHeight=Math.floor(rowHeight*0.025);$(this).height(rowHeight-bufferHeight);$(this).find('img').each(function(){ var imageHeight=($(this).attr('height')*parseInt($(this).css('width'),10))/$(this).attr('width');var marginOffset=((rowHeight-imageHeight)*0.5)+'px';});});$(elem).attr('data-width',w);}}resizePhotosetGrid();$(window).on("resize",function(){resizePhotosetGrid();});}; var waitForImagesLoaded=true;var hasDimensions=true;$(elem).find('img').each(function(){hasDimensions=hasDimensions&(!!$(this).attr('height')&!!$(this).attr('width'));});waitForImagesLoaded=!hasDimensions; if(waitForImagesLoaded){$(elem).imagesLoaded(function(){setupStyles(waitForImagesLoaded);$this._callback(elem);});}else{setupStyles(waitForImagesLoaded);$this._callback(elem);}}}; $.fn[pluginName]=function(options){return this.each(function(){if(!$.data(this,"plugin_"+pluginName)){$.data(this,"plugin_"+pluginName,new Plugin(this,options));}});};var BLANK='data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==';$.fn.imagesLoaded=function(callback){var $this=this,deferred=$.isFunction($.Deferred)?$.Deferred():0,hasNotify=$.isFunction(deferred.notify),$images=$this.find('img').add($this.filter('img')),loaded=[],proper=[],broken=[]; if($.isPlainObject(callback)){$.each(callback,function(key,value){if(key==='callback'){callback=value;}else if(deferred){deferred[key](value);}});}function doneLoading(){var $proper=$(proper),$broken=$(broken);if(deferred){if(broken.length){deferred.reject($images,$proper,$broken);}else{deferred.resolve($images);}}if($.isFunction(callback)){callback.call($this,$images,$proper,$broken);}}function imgLoadedHandler(event){imgLoaded(event.target,event.type==='error');}function imgLoaded(img,isBroken){ if(img.src===BLANK||$.inArray(img,loaded)!==-1){return;}loaded.push(img); if(isBroken){broken.push(img);}else{proper.push(img);}$.data(img,'imagesLoaded',{isBroken:isBroken,src:img.src}); if(hasNotify){deferred.notifyWith($(img),[isBroken,$images,$(proper),$(broken)]);}if($images.length===loaded.length){setTimeout(doneLoading);$images.unbind('.imagesLoaded',imgLoadedHandler);}}if(!$images.length){doneLoading();}else{$images.bind('load.imagesLoaded error.imagesLoaded',imgLoadedHandler).each(function(i,el){var src=el.src;var cached=$.data(el,'imagesLoaded');if(cached&&cached.src===src){imgLoaded(el,cached.isBroken);return;}if(el.complete&&el.naturalWidth!==undefined){imgLoaded(el,el.naturalWidth===0||el.naturalHeight===0);return;}if(el.readyState||el.complete){el.src=BLANK;el.src=src;}});}return deferred?deferred.promise($this):$this;};var $event=$.event,$special,dummy={_:0},frame=0,wasResized,animRunning;$special=$event.special.throttledresize={setup:function(){$(this).on("resize",$special.handler);},teardown:function(){$(this).off("resize",$special.handler);},handler:function(event,execAsap){ var context=this,args=arguments;wasResized=true;if(!animRunning){setInterval(function(){frame++;if(frame>$special.threshold&&wasResized||execAsap){ event.type="throttledresize";$event.dispatch.apply(context,args);wasResized=false;frame=0;}if(frame>9){$(dummy).stop();animRunning=false;frame=0;}},30);animRunning=true;}},threshold:0};})(jQuery,window,document); $('.photoset-post-photoset').photosetGrid();});